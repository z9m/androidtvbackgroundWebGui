<!DOCTYPE html>
<html>
<head>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <title>TV Background Suite</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Alice&family=Andika&family=Arvo:wght@400;700&family=Barrio&family=Bungee+Spice&family=Codystar&family=Creepster&family=Diplomata+SC&family=Ewert&family=Fascinate+Inline&family=Faster+One&family=Fira+Sans:wght@300;400;700&family=Flavors&family=Fredericka+the+Great&family=Honk&family=IBM+Plex+Sans:wght@300;400;700&family=Inter:wght@300;400;700&family=Jost:wght@300;400;700&family=Lacquer&family=Lato:wght@300;400;700&family=Manrope:wght@300;400;700&family=Merriweather:wght@300;400;700&family=Metal+Mania&family=Modak&family=Monoton&family=Montserrat:wght@300;400;700&family=Mulish:wght@300;400;700&family=Nabla&family=Nosifer&family=Nunito:wght@300;400;700&family=Open+Sans:wght@300;400;700&family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;700&family=Rubik+Beastly&family=Rubik+Vinyl&family=Shojumaru&family=Silkscreen&family=Space+Grotesk:wght@300;400;700&family=Special+Elite&family=Titillium+Web:wght@300;400;700&family=Urbanist:wght@300;400;700&family=Zilla+Slab+Highlight&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/editor.css') }}">
</head>
<body>

    <div class="nav-tabs">
        <div class="tab-link active" onclick="openTab(event, 'editor-tab')">üé® Layout Editor</div>
        <div class="tab-link" onclick="openTab(event, 'layouts-tab'); loadLayoutsList()">üíæ Saved Layouts</div>
        <div class="tab-link" onclick="openTab(event, 'gallery-tab'); loadGallery()">üñºÔ∏è Gallery</div>
        <div class="tab-link" onclick="openTab(event, 'batch-tab'); loadBatchLayouts()">‚ö° Batch Processing</div>
        <div class="tab-link" onclick="openTab(event, 'overlay-tab')">üìè Overlay Manager</div>
        <div class="tab-link" onclick="openTab(event, 'texture-tab')">üé® Texture Manager</div>
        <div class="tab-link" onclick="openTab(event, 'font-tab')">üî§ Font Manager</div>
        <div class="tab-link" onclick="openTab(event, 'settings-tab')">‚öôÔ∏è Provider Settings</div>
    </div>

    <div id="editor-tab" class="tab-content active">
        <div class="sidebar">
            <div class="control-group">
                <h3>Layout Management</h3>
                <button id="btn-save-changes" onclick="saveEditedImage()" style="background: #d32f2f; margin-bottom: 10px; display: none;">üíæ Save Changes</button>
                <label>Layout Name</label>
                <input type="text" id="layoutName" placeholder="e.g. Dark Mode Minimal" value="Default">
                <label>Tag Alignment</label>
                <select id="tagAlignSelect" onchange="updateVerticalLayout(); saveToLocalStorage()">
                    <option value="left">Left</option>
                    <option value="center" selected>Center</option>
                    <option value="right">Right</option>
                </select>
                <label>Text Content Alignment</label>
                <select id="textContentAlignSelect" onchange="updateVerticalLayout(); saveToLocalStorage()">
                    <option value="left" selected>Left</option>
                    <option value="center">Center</option>
                    <option value="right">Right</option>
                    <option value="justify">Justify</option>
                </select>
                <div style="margin-top:5px;">
                    <div style="display:flex; justify-content:space-between;"><label for="genreLimitSlider" style="font-size:11px; margin:0;">Genre Limit</label><span id="genreLimitVal" style="font-size:11px;">Max</span></div>
                    <input type="range" id="genreLimitSlider" min="1" max="6" value="6" oninput="updateGenreLimit()" style="margin-top:2px;">
                </div>
                <button onclick="saveLayout()" style="background: #00796b; margin-top: 10px;">üíæ Save Layout</button>
            </div>

            <div class="control-group">
                <h3>Logos & Icons</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                    <button onclick="addLogo('https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/IMDB_Logo_2016.svg/1200px-IMDB_Logo_2016.svg.png')" style="grid-column: 1 / -1;">IMDb Logo</button>
                </div>
                <div id="icon-properties" style="display:none; margin-top:10px; border-top:1px solid #333; padding-top:10px;">
                    <label for="iconSizeInput">Icon Size</label>
                    <input type="number" id="iconSizeInput" min="10" max="500" oninput="updateIconSize()">
                    <div style="display:flex; align-items:center; gap:10px; margin-top:10px;">
                        <input type="checkbox" id="matchHeightToggle" onchange="toggleMatchHeight()" style="width:20px; height:20px; margin:0;">
                        <label for="matchHeightToggle" style="margin:0; cursor:pointer; font-size:11px;">Match Height to Neighbor</label>
                    </div>
                </div>
            </div>

            <div class="control-group">
                <h3>Metadata Tags</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                    <button onclick="addMetadataTag('title', 'TITLE / LOGO')">Title/Logo</button>
                    <button onclick="addMetadataTag('year', '2024')">Year</button>
                    <button onclick="addMetadataTag('rating', 'IMDb: 8.5')">Rating (Text)</button>
                    <button onclick="addMetadataTag('rating_star', '8.5')">Rating (Star)</button>
                    <button onclick="addMetadataTag('rating_val', '8.5')">Rating (Value)</button>
                    <button onclick="addMetadataTag('runtime', '2h 15m')">Runtime</button>
                    <button onclick="addMetadataTag('genres', 'Action, Sci-Fi')">Genres</button>
                    <button onclick="addMetadataTag('overview', 'Movie description...')">Overview</button>
                    <button onclick="addMetadataTag('provider_source', 'Now available on...')">Provider Info</button>
                    <button onclick="addMetadataTag('certification', 'FSK 16')">Age Rating (Image)</button>
                </div>
            </div>

            <div class="control-group">
                <h3>Preview Controls</h3>
                <div style="display:flex; gap:5px; margin-bottom:5px;">
                    <input type="text" id="mediaSearchInput" placeholder="Search title..." style="margin-top:0;" onkeydown="if(event.key==='Enter') searchMedia()">
                    <button onclick="searchMedia()" style="width:auto; margin-top:0;">üîç</button>
                </div>
                <button id="btn-shuffle" onclick="fetchRandomPreview()" style="background: #1565c0;">üé≤ Shuffle Preview</button>
                <p id="source-indicator" style="font-size: 9px; color: #555; text-align: center; margin-top: 5px;">Source: None</p>
            </div>

            <div class="control-group">
                <h3>Canvas</h3>
                <label for="resSelect">Resolution</label>
                <select id="resSelect" onchange="changeResolution()">
                    <option value="1080">1080p (Full HD)</option>
                    <option value="2160">2160p (4K)</option>
                </select>
                <label for="overlaySelect">Guide Overlay</label>
                <select id="overlaySelect" onchange="updateOverlay()">
                    <option value="">None</option>
                </select>
                <label>Background Color</label>
                <div style="display:flex; gap:5px; align-items:center;">
                    <input type="color" id="bgColor" oninput="updateBgColor()" value="#000000" style="height:35px; width:60px;">
                    <button onclick="autoDetectBgColor(true)" style="margin-top:0; font-size: 11px;">‚ú® Auto-Detect</button>
                </div>
                <div style="display:flex; justify-content:space-between; margin-top:5px;">
                    <label style="font-size:10px; margin:0;">Brightness</label>
                    <span id="brightVal" style="font-size:10px;">20%</span>
                </div>
                <input type="range" id="bgBrightness" min="0" max="100" value="20" oninput="adjustAutoBrightness()" style="margin-top:2px;">
                <button onclick="mirrorBackground()" style="margin-top: 10px; background-color: #4a4a4a;">‚ÜîÔ∏è Mirror Background</button>
            </div>

            <div class="control-group">
                <h3>Background Effects</h3>
                <label>Effect Type</label>
                <select id="fadeEffect" onchange="updateFadeControls()">
                    <option value="custom">Custom Linear Fade</option>
                    <option value="bottom-left">Corner Fade: Bottom-Left</option>
                    <option value="bottom-right">Corner Fade: Bottom-Right</option>
                    <option value="top-left">Corner Fade: Top-Left</option>
                    <option value="top-right">Corner Fade: Top-Right</option>
                    <option value="vignette">Vignette Fade (Centered)</option>
                </select>
                <div id="ctrl-fade-radius" style="display:none;">
                    <label for="fadeRadius">Corner Radius</label>
                    <input type="range" id="fadeRadius" min="0" max="3000" value="1000" oninput="updateFades()">
                </div>
                <div id="ctrl-fade-left"><label for="fadeLeft">Left</label><input type="range" id="fadeLeft" min="0" max="3000" value="580" oninput="updateFades()"></div>
                <div id="ctrl-fade-right"><label for="fadeRight">Right</label><input type="range" id="fadeRight" min="0" max="3000" value="0" oninput="updateFades()"></div>
                <div id="ctrl-fade-top"><label for="fadeTop">Top</label><input type="range" id="fadeTop" min="0" max="2000" value="0" oninput="updateFades()"></div>
                <div id="ctrl-fade-bottom"><label for="fadeBottom">Bottom</label><input type="range" id="fadeBottom" min="0" max="2000" value="320" oninput="updateFades()"></div>
            </div>

            <div class="control-group" id="text-properties" style="display:none;">
                <h3>Text Properties</h3>
                <label for="fontSizeInput">Font Size</label>
                <input type="number" id="fontSizeInput" min="10" max="200" oninput="updateSelectedFontSize()">
                <label for="fontFamilySelect">Font Family</label>
                <select id="fontFamilySelect" onchange="updateSelectedFontFamily()">
                    <option value="Roboto" selected>Roboto</option>
                    <option value="Segoe UI">Segoe UI (System)</option>
                    <option value="Open Sans">Open Sans</option>
                    <option value="Lato">Lato</option>
                    <option value="Montserrat">Montserrat</option>
                    <option value="Merriweather">Merriweather</option>
                    <option value="Playfair Display">Playfair Display</option>
                    <option value="Space Grotesk">Space Grotesque</option>
                    <option value="Nunito">Nunito</option>
                    <option value="Manrope">Manrope</option>
                    <option value="Jost">Jost</option>
                    <option value="Titillium Web">Titillium Web</option>
                    <option value="Mulish">Muli</option>
                    <option value="Urbanist">Urbanist</option>
                    <option value="Inter">Inter</option>
                    <option value="Abril Fatface">Abril Fatface</option>
                    <option value="Arvo">Arvo</option>
                    <option value="IBM Plex Sans">IBM Plex Sans</option>
                    <option value="Alice">Alice</option>
                    <option value="Fira Sans">Fira Sans</option>
                    <option value="Evolventa">Evolventa</option>
                    <option value="Andika">Andika</option>
                    <option value="Nabla">Nabla</option>
                    <option value="Honk">Honk</option>
                    <option value="Monoton">Monoton</option>
                    <option value="Rubik Beastly">Rubik Beastly</option>
                    <option value="Faster One">Faster One</option>
                    <option value="Creepster">Creepster</option>
                    <option value="Modak">Modak</option>
                    <option value="Silkscreen">Silkscreen</option>
                    <option value="Lacquer">Lacquer</option>
                    <option value="Zilla Slab Highlight">Zilla Slab Highlight</option>
                    <option value="Codystar">Codystar</option>
                    <option value="Fascinate Inline">Fascinate Inline</option>
                    <option value="Ewert">Ewert</option>
                    <option value="Nosifer">Nosifer</option>
                    <option value="Shojumaru">Shojumaru</option>
                    <option value="Bungee Spice">Bungee Spice</option>
                    <option value="Rubik Vinyl">Rubik Vinyl</option>
                    <option value="Special Elite">Special Elite</option>
                    <option value="Flavors">Flavors</option>
                    <option value="Barrio">Barrio</option>
                    <option value="Fredericka the Great">Fredericka the Great</option>
                    <option value="Metal Mania">Metal Mania</option>
                    <option value="Diplomata SC">Diplomata SC</option>
                </select>
                <button onclick="applyFontToAll()" style="margin-top: 5px; font-size: 11px; background-color: #4a4a4a;">Apply Font & Color to All Tags</button>
                
                <label>Fill Type</label>
                <div style="display:flex; gap:10px; margin-bottom:5px;">
                    <input type="radio" id="fillTypeColor" name="fillType" value="color" checked onchange="toggleTextFillType()">
                    <label for="fillTypeColor" style="margin:0; font-size:12px;">Color</label>
                    <input type="radio" id="fillTypeTexture" name="fillType" value="texture" onchange="toggleTextFillType()">
                    <label for="fillTypeTexture" style="margin:0; font-size:12px;">Texture</label>
                </div>
                <div id="fillColorContainer">
                    <label for="fontColorInput">Text Color</label>
                    <input type="color" id="fontColorInput" oninput="updateSelectedColor()" style="height:35px;">
                </div>
                <div id="fillTextureContainer" style="display:none;">
                    <label for="textureSelect">Select Texture</label>
                    <select id="textureSelect" onchange="applyTextureToSelection()" style="width:100%; padding:5px;"><option value="">None</option></select>
                    <div style="display:flex; justify-content:space-between; margin-top:5px;">
                        <label style="font-size:10px; margin:0;">Pattern Scale</label>
                        <span id="textureScaleVal" style="font-size:10px;">1x</span>
                    </div>
                    <input type="range" id="textureScale" min="0.1" max="3" step="0.1" value="1" oninput="updateTextureScale()" style="margin-top:2px;">
                    <div style="display:flex; justify-content:space-between; margin-top:5px;">
                        <label style="font-size:10px; margin:0;">Pattern Rotation</label>
                        <span id="textureRotationVal" style="font-size:10px;">0¬∞</span>
                    </div>
                    <input type="range" id="textureRotation" min="0" max="360" step="1" value="0" oninput="updateTextureRotation()" style="margin-top:2px;">
                    <div style="display:flex; justify-content:space-between; margin-top:5px;">
                        <label style="font-size:10px; margin:0;">Opacity</label>
                        <span id="textureOpacityVal" style="font-size:10px;">100%</span>
                    </div>
                    <input type="range" id="textureOpacity" min="0" max="100" value="100" oninput="updateTextureOpacity()" style="margin-top:2px;">
                    <button onclick="resetTextureSettings()" style="margin-top: 10px; font-size: 11px; background-color: #4a4a4a; width: 100%;">Reset Texture Settings</button>
                </div>

                <div id="textAlignControl" style="display:none; margin-top:10px;">
                    <label style="margin-bottom:5px;">Text Alignment</label>
                    <div style="display:flex; gap:5px;">
                        <button onclick="setTextAlignment('left')" style="flex:1;">Left</button>
                        <button onclick="setTextAlignment('center')" style="flex:1;">Center</button>
                        <button onclick="setTextAlignment('right')" style="flex:1;">Right</button>
                    </div>
                </div>
                <div id="textBackgroundControl" style="display:none; margin-top:10px; border-top:1px solid #333; padding-top:10px;">
                    <div style="display:flex; align-items:center; gap:10px; margin-bottom:5px;">
                        <input type="checkbox" id="textBgEnable" onchange="toggleTextBackground()" style="width:20px; height:20px; margin:0;">
                        <label for="textBgEnable" style="margin:0; cursor:pointer; font-size:11px;">Background Box</label>
                    </div>
                    <div id="textBgSettings" style="display:none;">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:5px;">
                            <input type="checkbox" id="textBgAuto" onchange="updateTextBackgroundSettings()" style="width:20px; height:20px; margin:0;">
                            <label for="textBgAuto" style="margin:0; cursor:pointer; font-size:11px;">Auto-Color (Match BG)</label>
                        </div>
                        <label for="textBgColor">Box Color</label>
                        <input type="color" id="textBgColor" oninput="updateTextBackgroundSettings()" style="height:35px;">
                        <div style="display:flex; justify-content:space-between; margin-top:5px;">
                            <label style="font-size:10px; margin:0;">Opacity</label>
                            <span id="textBgOpacityVal" style="font-size:10px;">50%</span>
                        </div>
                        <input type="range" id="textBgOpacity" min="0" max="100" value="50" oninput="updateTextBackgroundSettings()" style="margin-top:2px;">
                    </div>
                </div>
            </div>

            <div style="margin-top:auto">
                <button class="btn-export" onclick="saveImage()">üíæ Export JPG (Download)</button>
                <button id="btn-save-gallery" onclick="saveToGallery()" style="background: #e65100; margin-top: 10px;">üìÇ Save to Gallery</button>
            </div>
        </div>

        <div class="main-view">
            <button onclick="toggleGrid()" style="position:absolute; top:20px; left:20px; width:auto; z-index:100; background-color: #4a4a4a; padding: 8px 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.5);">üìè Toggle Grid</button>
            <div id="canvas-wrapper">
                <canvas id="mainCanvas"></canvas>
            </div>
        </div>
    </div>

    <div id="batch-tab" class="tab-content">
        <div class="main-view" style="padding: 20px; align-items: flex-start;">
            <div class="batch-grid" style="width: 100%; max-width: 1200px;">
                <div class="sidebar" style="width: 100%; height: auto; border: 1px solid #333; border-radius: 8px;">
                    <h3>Batch Configuration</h3>
                    
                    <label for="batchLayoutSelect">Select Layout</label>
                    <select id="batchLayoutSelect"></select>
                    
                    <label for="batchMode">Source Mode</label>
                    <select id="batchMode" onchange="toggleBatchInputs()">
                        <option value="random">Random Selection</option>
                        <option value="library">Full Library (Jellyfin)</option>
                    </select>

                    <div id="batchFilterSettings" style="display:none; margin-top:10px; border-top:1px solid #333; padding-top:10px;">
                        <label for="batchFilterMode">Filter Strategy</label>
                        <select id="batchFilterMode" onchange="toggleBatchInputs()">
                            <option value="all">None (All Items A-Z)</option>
                            <option value="recent">Recently Added</option>
                            <option value="year">By Year</option>
                            <option value="genre">By Genre</option>
                            <option value="rating">By Minimum Rating</option>
                            <option value="official_rating">By Age Rating</option>
                            <option value="custom">Custom (Advanced)</option>
                        </select>

                        <div id="filterInputYear" style="display:none;">
                            <label>Year</label>
                            <input type="number" id="batchFilterYear" placeholder="e.g. 2024" value="2024">
                        </div>
                        <div id="filterInputGenre" style="display:none;">
                            <label>Genre</label>
                            <input type="text" id="batchFilterGenre" placeholder="e.g. Action">
                        </div>
                        <div id="filterInputRating" style="display:none;">
                            <label>Min Rating (0-10)</label>
                            <input type="number" id="batchFilterRating" value="7.0" step="0.1" min="0" max="10">
                        </div>
                        <div id="filterInputOfficialRating" style="display:none;">
                            <label>Age Rating (e.g. FSK 16, PG-13)</label>
                            <input type="text" id="batchFilterOfficialRating" placeholder="e.g. FSK 16">
                        </div>
                        <div id="filterInputCustom" style="display:none;">
                            <div style="display:flex; gap:10px; margin-bottom:5px;">
                                <div style="flex:1;">
                                    <label>Min Year</label>
                                    <input type="number" id="batchFilterMinYear" placeholder="e.g. 2015">
                                </div>
                                <div style="flex:1;">
                                    <label>Max Year</label>
                                    <input type="number" id="batchFilterMaxYear" placeholder="e.g. 2025">
                                </div>
                            </div>
                            <div style="display:flex; gap:10px;">
                                <div style="flex:1;">
                                    <label>Min Rating</label>
                                    <input type="number" id="batchFilterMinRating" step="0.1" min="0" max="10" placeholder="e.g. 6.0">
                                </div>
                                <div style="flex:1;">
                                    <label>Genre</label>
                                    <input type="text" id="batchFilterCustomGenre" placeholder="e.g. Action">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="batchRandomSettings">
                        <label for="batchCount">Number of Images</label>
                        <input type="number" id="batchCount" value="10" min="1" max="10000">
                    </div>

                    <div style="display:flex; align-items:center; gap:10px; margin-top:10px;">
                        <input type="checkbox" id="batchOverwrite" style="width:20px; height:20px; margin:0;" {% if config.general.overwrite_existing %}checked{% endif %}>
                        <label for="batchOverwrite" style="margin:0; cursor:pointer;">Overwrite Existing</label>
                    </div>
                    
                    <div style="display:flex; align-items:center; gap:10px; margin-top:5px;">
                        <input type="checkbox" id="batchSortGenre" style="width:20px; height:20px; margin:0;">
                        <label for="batchSortGenre" style="margin:0; cursor:pointer;">Sort by Genre (Subfolders)</label>
                    </div>
                    <div style="display:flex; align-items:center; gap:10px; margin-top:5px;">
                        <input type="checkbox" id="batchDryRun" style="width:20px; height:20px; margin:0;">
                        <label for="batchDryRun" style="margin:0; cursor:pointer;">Dry Run (Simulate only)</label>
                    </div>

                    <button id="btn-start-batch" onclick="startBatchProcess()" style="margin-top: 20px; background: #2e7d32;">‚ñ∂ Start Batch</button>
                    <button id="btn-stop-batch" onclick="stopBatchProcess()" style="margin-top: 10px; background: #c62828; display: none;">‚èπ Stop</button>
                </div>

                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <div class="progress-container">
                        <div id="batchProgressBar" class="progress-bar">0%</div>
                    </div>
                    <div id="batchLog" class="console-log">Ready to start...</div>
                    <!-- Optional: Live Preview Image -->
                    <div style="flex: 1; background: #000; border: 1px solid #333; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                        <img id="batchPreviewImg" style="max-width: 100%; max-height: 400px; opacity: 0.5;" src="">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="layouts-tab" class="tab-content">
        <div class="gallery-container" id="layouts-content">
            <p style="color:#888; text-align:center; margin-top:50px;">Loading layouts...</p>
        </div>
    </div>

    <div id="gallery-tab" class="tab-content">
        <div class="gallery-container" id="gallery-content">
            <p style="color:#888; text-align:center; margin-top:50px;">Loading images...</p>
        </div>
    </div>

    <div id="overlay-tab" class="tab-content">
        <div class="main-view" style="padding: 20px; align-items: flex-start;">
            <div class="sidebar" style="width: 100%; max-width: 800px; margin: 0 auto; border: 1px solid #333; border-radius: 8px;">
                <h3>Overlay Manager</h3>
                <div class="control-group" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h4>Add New Overlay Profile</h4>
                    <label>Profile Name</label>
                    <input type="text" id="newOverlayName" placeholder="e.g. Google TV">
                    <label>1080p Image (Optional)</label>
                    <input type="file" id="newOverlay1080" accept="image/*">
                    <label>4K Image (Optional)</label>
                    <input type="file" id="newOverlay4K" accept="image/*">
                    <button onclick="addOverlay()" style="margin-top: 15px; background-color: #4CAF50;">Save Profile</button>
                </div>
                <h4>Existing Profiles</h4>
                <div id="overlayList"></div>
            </div>
        </div>
    </div>

    <div id="texture-tab" class="tab-content">
        <div class="main-view" style="padding: 20px; align-items: flex-start;">
            <div class="sidebar" style="width: 100%; max-width: 800px; margin: 0 auto; border: 1px solid #333; border-radius: 8px;">
                <h3>Texture Manager</h3>
                <div class="control-group" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h4>Add New Texture</h4>
                    <label>Texture Name</label>
                    <input type="text" id="newTextureName" placeholder="e.g. Gold Foil">
                    <label>Image File</label>
                    <input type="file" id="newTextureFile" accept="image/*">
                    <button onclick="addTexture()" style="margin-top: 15px; background-color: #4CAF50;">Save Texture</button>
                </div>
                <h4>Existing Textures</h4>
                <div id="textureList"></div>
            </div>
        </div>
    </div>

    <div id="font-tab" class="tab-content">
        <div class="main-view" style="padding: 20px; align-items: flex-start;">
            <div class="sidebar" style="width: 100%; max-width: 800px; margin: 0 auto; border: 1px solid #333; border-radius: 8px;">
                <h3>Font Manager</h3>
                <div class="control-group" style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                    <h4>Add New Font (.ttf, .otf, .woff)</h4>
                    <label>Font File</label>
                    <input type="file" id="newFontFile" accept=".ttf,.otf,.woff,.woff2">
                    <button onclick="addFont()" style="margin-top: 15px; background-color: #4CAF50;">Upload Font</button>
                </div>
                <h4>Installed Custom Fonts</h4>
                <div id="fontList"></div>
            </div>
        </div>
    </div>

    <div id="settings-tab" class="tab-content">
        <div class="settings-grid">
            <div class="sidebar" style="width:100%; border:1px solid #333; border-radius:8px;">
                <h3>Jellyfin</h3>
                <label for="set-jf-url">Server URL</label>
                <input type="text" id="set-jf-url" value="{{ config.jellyfin.url }}">
                <label for="set-jf-key">API Key</label>
                <input type="password" id="set-jf-key" value="{{ config.jellyfin.api_key }}">
                <label for="set-jf-user">User ID</label>
                <input type="text" id="set-jf-user" value="{{ config.jellyfin.user_id }}">
                <label for="set-jf-exclude">Excluded Libraries (comma separated)</label>
                <input type="text" id="set-jf-exclude" value="{{ config.jellyfin.excluded_libraries }}">
            </div>

            <div class="sidebar" style="width:100%; border:1px solid #333; border-radius:8px;">
                <h3>Plex</h3>
                <label for="set-plex-url">Server URL</label>
                <input type="text" id="set-plex-url" value="{{ config.plex.url }}">
                <label for="set-plex-token">Token</label>
                <input type="password" id="set-plex-token" value="{{ config.plex.token }}">
            </div>

            <div class="sidebar" style="width:100%; border:1px solid #333; border-radius:8px;">
                <h3>TMDB</h3>
                <label for="set-tmdb-key">API Key (Bearer Token)</label>
                <input type="password" id="set-tmdb-key" value="{{ config.tmdb.api_key }}">
                <label for="set-tmdb-lang">Language</label>
                <input type="text" id="set-tmdb-lang" value="{{ config.tmdb.language }}">
            </div>

            <div class="sidebar" style="width:100%; border:1px solid #333; border-radius:8px;">
                <h3>Radarr & Sonarr</h3>
                <label for="set-radarr-url">Radarr URL</label>
                <input type="text" id="set-radarr-url" value="{{ config.radarr.url }}">
                <label for="set-radarr-key">Radarr API Key</label>
                <input type="password" id="set-radarr-key" value="{{ config.radarr.api_key }}">
                <hr style="border-color:#333; margin:15px 0;">
                <label for="set-sonarr-url">Sonarr URL</label>
                <input type="text" id="set-sonarr-url" value="{{ config.sonarr.url }}">
                <label for="set-sonarr-key">Sonarr API Key</label>
                <input type="password" id="set-sonarr-key" value="{{ config.sonarr.api_key }}">
            </div>

            <div class="sidebar" style="width:100%; border:1px solid #333; border-radius:8px;">
                <h3>Other Services</h3>
                <label for="set-jellyseerr-url">Jellyseerr URL</label>
                <input type="text" id="set-jellyseerr-url" value="{{ config.jellyseerr.url }}">
                <label for="set-jellyseerr-key">Jellyseerr API Key</label>
                <input type="password" id="set-jellyseerr-key" value="{{ config.jellyseerr.api_key }}">
                <hr style="border-color:#333; margin:15px 0;">
                <label for="set-trakt-key">Trakt Client ID</label>
                <input type="password" id="set-trakt-key" value="{{ config.trakt.api_key }}">
                <label for="set-trakt-user">Trakt Username</label>
                <input type="text" id="set-trakt-user" value="{{ config.trakt.username }}">
                <label for="set-trakt-list">Trakt List Name</label>
                <input type="text" id="set-trakt-list" value="{{ config.trakt.listname }}">
            </div>

            <button onclick="saveSettings()" style="grid-column: 1 / -1; max-width: 400px; margin: 20px auto;">Save Settings</button>
        </div>
    </div>

    <div id="lightbox" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:1000; justify-content:center; align-items:center;">
        <span onclick="closeLightbox()" style="position:absolute; top:20px; right:35px; color:#fff; font-size:40px; cursor:pointer; user-select:none;">&times;</span>
        <img id="lightbox-img" style="max-width:90%; max-height:90%; object-fit:contain;">
        <span onclick="changeLightboxImage(-1)" style="position:absolute; top:50%; left:20px; color:#fff; font-size:40px; cursor:pointer; transform:translateY(-50%); user-select:none;">&#10094;</span>
        <span onclick="changeLightboxImage(1)" style="position:absolute; top:50%; right:20px; color:#fff; font-size:40px; cursor:pointer; transform:translateY(-50%); user-select:none;">&#10095;</span>
        <button id="lightbox-edit-btn" style="position:absolute; bottom:20px; right:20px; width:auto; padding:10px 20px; font-size:16px; background:#d32f2f; color:white; border:none; cursor:pointer; z-index:1001; border-radius:4px;">‚úèÔ∏è Edit</button>
    </div>

    <div id="preview-popup">
        <div style="display:flex; justify-content:space-between; width:100%; max-width:1600px; margin:0 auto 20px auto; color:white; align-items:center;">
            <h2 style="margin:0; font-size:24px;">Generated Previews</h2>
            <span onclick="closePreviewPopup()" style="font-size:40px; cursor:pointer; line-height:1;">&times;</span>
        </div>
        <div id="preview-grid" style="width:100%; max-width:1600px; margin:0 auto;"></div>
    </div>

    <script>
        window.initialBackdropUrl = "{{ data.backdrop_url }}";
    </script>
    <script src="{{ url_for('static', filename='js/gallery.js') }}"></script>
    <script src="{{ url_for('static', filename='js/batch.js') }}"></script>
    <script src="{{ url_for('static', filename='js/editor.js') }}"></script>
</body>
</html>
